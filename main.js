(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-8",headers:{authorization:"6017ffdb-621e-4e57-b0de-7d3de0044eb2","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function n(e,t,n,r,c){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__title"),i=u.querySelector(".card__image"),s=u.querySelector(".card__like-button"),l=u.querySelector(".card__like-counter");a.textContent=e.name,i.src=e.link,i.alt="Фото: ".concat(e.name),e.likes?l.textContent=e.likes.length:l.textContent=0,e.likes&&Array.isArray(e.likes)&&e.likes.forEach((function(t){(function(e,t){return e===t})(t._id,e.userId)&&o(s)})),s.addEventListener("click",(function(){r(s,e._id,l)})),i.addEventListener("click",(function(){return n(e.link,e.name)}));var d=u.querySelector(".card__delete-button");return d.addEventListener("click",(function(){c(t,e._id,u)})),e.owner._id!==e.userId?d.classList.add("card__delete-button_hidden"):d.classList.remove("card__delete-button_hidden"),u}function o(e){e.classList.toggle("card__like-button_is-active")}function r(t,n,r){(function(e,t,n){return e?function(e,t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{headers:e.headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t,n):function(e,t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{headers:e.headers,method:"PUT"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t,n)})(t.classList.contains("card__like-button_is-active"),e,n).then((function(e){var n=e.likes.length;!function(e,t){e.textContent=t}(r,n),o(t)})).catch((function(e){console.log(e)}))}var c=function(e,t,n){e.disabled=!0,e.classList.add(n,t)},u=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function a(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):c(t,n.inactiveButtonClass)}var i=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.value="",u(e,n,t)})),c(o,t.inactiveButtonClass)};function s(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",d)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",d)}function d(e){"Escape"===e.key&&l(document.querySelector(".popup_is-opened"))}function p(e){e.target.classList.contains("popup")&&l(e.target)}var f,m=document.querySelectorAll(".popup"),_=document.querySelector(".popup__image"),v=document.querySelector(".popup_type_image"),y=document.querySelector(".popup__caption"),h=document.querySelector(".popup_type_edit"),S=document.querySelector(".popup_type_avatar"),b=document.querySelector(".popup_type_new-card"),q=document.querySelector(".profile__title"),k=document.querySelector(".profile__image"),E=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__description"),g=b.querySelector(".popup__form"),x=g.querySelector(".popup__input_type_card-name"),A=g.querySelector(".popup__input_type_url"),T=document.querySelectorAll(".popup__close"),U=document.querySelector(".places__list"),P=document.querySelector(".popup_type_delete-card"),j=document.forms["new-place"],B=document.forms["edit-avatar"],w=document.forms["edit-profile"],D=document.forms["delete-card"],I=j.elements["place-name"],N=j.elements.link,O=B.elements.link,J=w.elements.name,M=w.elements.description,H=h.querySelector(".popup__form"),V=H.querySelector(".popup__input_type_name"),z=H.querySelector(".popup__input_type_description");function F(e,t,n){G=t,K=n,s(e)}var G,K,Q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function R(e,t){e.target.querySelector(".button").innerText=t}function W(e){e.target.querySelector(".button").innerText="Сохранение..."}function X(e,t){_.src=e,_.alt=t,y.textContent=t,s(v)}!function(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);a(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),a(n,o,t)}))}))}(t,e)}))}(Q),Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t)]).then((function(e){var t=e[0],o=e[1];k.style.backgroundImage="url('".concat(t.avatar,"')"),q.textContent=t.name,C.textContent=t.about,f=t._id,o&&Array.isArray(o)?o.forEach((function(e){e.userId=f;var t=n(e,P,X,r,F);U.append(t)})):console.log("Данные о карточках не были получены или пусты.")})).catch((function(e){console.log("Произошла ошибка при загрузке данных о карточках:",e)})),L.addEventListener("click",(function(){i(H,Q),s(h),V.value=q.textContent,z.value=C.textContent})),E.addEventListener("click",(function(){i(g,Q),s(b)})),k.addEventListener("click",(function(){i(g,Q),s(S)})),T.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){l(t)}))})),m.forEach((function(e){return function(e){e.addEventListener("click",p)}(e)})),w.addEventListener("submit",(function(n){n.preventDefault(),W(n),function(n,o){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:o})}).then(t)}(V.value,z.value).then((function(e){q.textContent=e.name,C.textContent=e.about,l(h)})).catch((function(e){return console.log("Не удалось изменить профиль. ".concat(e))})).finally((function(){setTimeout((function(){return R(n,"Сохранить")}),600,n)}));var o=J.value,r=M.value;q.textContent=o,C.textContent=r,l(h)})),j.addEventListener("submit",(function(o){o.preventDefault(),W(o);var c,u,a={};a.name=I.value,a.link=N.value,(c=x.value,u=A.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:c,link:u})}).then(t)).then((function(e){e.userId=f;var t=n(e,P,X,r,F);U.prepend(t),l(b)})).catch((function(e){return console.log("Не удалось добавить карточку. ".concat(e))})).finally((function(){setTimeout((function(){return R(o,"Сохранить")}),600,o)})),j.reset()})),B.addEventListener("submit",(function(n){var o;n.preventDefault(),W(n),(o=O.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(t)).then((function(e){k.style.backgroundImage="url('".concat(e.avatar,"')"),l(S)})).finally((function(){setTimeout((function(){return R(n,"Сохранить")}),600,n)})).catch((function(e){console.log(e)})),B.reset()})),D.addEventListener("submit",(function(n){return function(n,o,r){var c;W(n),(c=o,fetch("".concat(e.baseUrl,"/cards/").concat(c),{method:"DELETE",headers:e.headers}).then(t)).then((function(){r.remove(),l(P)})).finally((function(){setTimeout((function(){return R(n,"Да")}),600,n)})).catch((function(e){console.log(e)}))}(n,G,K)}))})();