(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-8",headers:{authorization:"6017ffdb-621e-4e57-b0de-7d3de0044eb2","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function n(e,t,n,r,c){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__title"),i=u.querySelector(".card__image"),s=u.querySelector(".card__like-button"),l=u.querySelector(".card__like-counter");a.textContent=e.name,i.src=e.link,i.alt="Фото: ".concat(e.name),e.likes?l.textContent=e.likes.length:l.textContent=0,e.likes&&Array.isArray(e.likes)&&e.likes.forEach((function(t){(function(e,t){return e===t})(t._id,e.userId)&&o(s)})),s.addEventListener("click",(function(){r(s,e._id,l)})),i.addEventListener("click",(function(){return n(e.link,e.name)}));var d=u.querySelector(".card__delete-button");return d.addEventListener("click",(function(){c(t,e._id,u)})),e.owner._id!==e.userId?d.classList.add("card__delete-button_hidden"):d.classList.remove("card__delete-button_hidden"),u}function o(e){e.classList.toggle("card__like-button_is-active")}function r(t,n,r){(function(e,t,n){return e?function(e,t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{headers:e.headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t,n):function(e,t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{headers:e.headers,method:"PUT"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t,n)})(t.classList.contains("card__like-button_is-active"),e,n).then((function(e){var n=e.likes.length;!function(e,t){e.textContent=t}(r,n),o(t)})).catch((function(e){console.log(e)}))}var c=function(e,t,n){e.disabled=!0,e.classList.add(n,t)},u=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function a(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):c(t,n.inactiveButtonClass)}var i=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.value="",u(e,n,t)})),c(o,t.inactiveButtonClass)};function s(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",d)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",d)}function d(e){"Escape"===e.key&&l(document.querySelector(".popup_is-opened"))}function p(e){e.target.classList.contains("popup")&&l(e.target)}var f,m,_,v=document.querySelectorAll(".popup"),y=document.querySelector(".popup__image"),h=document.querySelector(".popup_type_image"),S=document.querySelector(".popup__caption"),b=document.querySelector(".popup_type_edit"),q=document.querySelector(".popup_type_avatar"),k=document.querySelector(".popup_type_new-card"),E=document.querySelector(".profile__title"),L=document.querySelector(".profile__image"),C=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__description"),A=k.querySelector(".popup__form"),T=A.querySelector(".popup__input_type_card-name"),U=A.querySelector(".popup__input_type_url"),P=document.querySelectorAll(".popup__close"),j=document.querySelector(".places__list"),B=document.querySelector(".popup_type_delete-card"),w=document.forms["new-place"],D=document.forms["edit-avatar"],I=document.forms["edit-profile"],N=document.forms["delete-card"],O=w.elements["place-name"],J=w.elements.link,M=D.elements.link,H=I.elements.name,V=I.elements.description,z=b.querySelector(".popup__form"),F=z.querySelector(".popup__input_type_name"),G=z.querySelector(".popup__input_type_description"),K={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function Q(e,t,n){m=t,_=n,s(e)}function R(e,t){e.target.querySelector(".button").innerText=t}function W(e){e.target.querySelector(".button").innerText="Сохранение..."}function X(e,t){y.src=e,y.alt=t,S.textContent=t,s(h)}!function(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);a(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),a(n,o,t)}))}))}(t,e)}))}(K),g.addEventListener("click",(function(){i(z,K),s(b),F.value=E.textContent,G.value=x.textContent})),C.addEventListener("click",(function(){i(A,K),s(k)})),L.addEventListener("click",(function(){i(A,K),s(q)})),N.addEventListener("submit",(function(n){return function(n,o,r){var c;W(n),(c=o,fetch("".concat(e.baseUrl,"/cards/").concat(c),{method:"DELETE",headers:e.headers}).then(t)).then((function(){r.remove(),l(B)})).finally((function(){setTimeout((function(){return R(n,"Да")}),600,n)})).catch((function(e){console.log(e)}))}(n,m,_)})),Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t)]).then((function(e){var t=e[0],o=e[1];L.style.backgroundImage="url('".concat(t.avatar,"')"),E.textContent=t.name,x.textContent=t.about,f=t._id,o&&Array.isArray(o)?o.forEach((function(e){e.userId=f;var t=n(e,B,X,r,Q);j.append(t)})):console.log("Данные о карточках не были получены или пусты.")})).catch((function(e){console.log("Произошла ошибка при загрузке данных о карточках:",e)})),g.addEventListener("click",(function(){H.value=E.textContent,V.value=x.textContent,s(b)})),C.addEventListener("click",(function(){s(k)})),P.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){l(t)}))})),v.forEach((function(e){return function(e){e.addEventListener("click",p)}(e)})),I.addEventListener("submit",(function(n){n.preventDefault(),W(n),function(n,o){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:o})}).then(t)}(F.value,G.value).then((function(e){E.textContent=e.name,x.textContent=e.about,l(b)})).catch((function(e){return console.log("Не удалось изменить профиль. ".concat(e))})).finally((function(){setTimeout((function(){return R(n,"Сохранить")}),600,n)}));var o=H.value,r=V.value;E.textContent=o,x.textContent=r,l(b)})),w.addEventListener("submit",(function(o){o.preventDefault(),W(o);var c,u,a={};a.name=O.value,a.link=J.value,(c=T.value,u=U.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:c,link:u})}).then(t)).then((function(e){e.userId=f;var t=n(e,B,X,r,Q);j.prepend(t),l(k)})).catch((function(e){return console.log("Не удалось добавить карточку. ".concat(e))})).finally((function(){setTimeout((function(){return R(o,"Сохранить")}),600,o)})),w.reset()})),D.addEventListener("submit",(function(n){var o;n.preventDefault(),W(n),(o=M.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(t)).then((function(e){L.style.backgroundImage="url('".concat(e.avatar,"')"),l(q)})).finally((function(){setTimeout((function(){return R(n,"Сохранить")}),600,n)})).catch((function(e){console.log(e)})),D.reset()}))})();