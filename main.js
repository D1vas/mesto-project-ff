(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-8",headers:{authorization:"6017ffdb-621e-4e57-b0de-7d3de0044eb2","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function n(e,n){return fetch(e,n).then(t)}function o(e,t,n,o,c){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__title"),i=u.querySelector(".card__image"),l=u.querySelector(".card__like-button"),s=u.querySelector(".card__like-counter");a.textContent=e.name,i.src=e.link,i.alt="Фото: ".concat(e.name),e.likes?s.textContent=e.likes.length:s.textContent=0,e.likes&&Array.isArray(e.likes)&&e.likes.forEach((function(t){(function(e,t){return e===t})(t._id,e.userId)&&r(l)})),l.addEventListener("click",(function(){o(l,e._id,s)})),i.addEventListener("click",(function(){return n(e.link,e.name)}));var d=u.querySelector(".card__delete-button");return d.addEventListener("click",(function(){c(t,e._id,u)})),e.owner._id!==e.userId?d.classList.add("card__delete-button_hidden"):d.classList.remove("card__delete-button_hidden"),u}function r(e){e.classList.toggle("card__like-button_is-active")}function c(t,o,c){(function(e,t,o){return e?function(e,t){return n("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers})}(t,o):function(e,t){return n("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers})}(t,o)})(t.classList.contains("card__like-button_is-active"),e,o).then((function(e){var n=e.likes.length;!function(e,t){e.textContent=t}(c,n),r(t)})).catch((function(e){console.log(e)}))}var u=function(e,t,n){e.disabled=!0,e.classList.add(n,t)},a=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function i(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):u(t,n.inactiveButtonClass)}var l=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.value="",a(e,n,t)})),u(o,t.inactiveButtonClass)};function s(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",p)}function d(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",p)}function p(e){"Escape"===e.key&&d(document.querySelector(".popup_is-opened"))}function f(e){e.target.classList.contains("popup")&&d(e.target)}var _,m=document.querySelectorAll(".popup"),v=document.querySelector(".popup__image"),y=document.querySelector(".popup_type_image"),h=document.querySelector(".popup__caption"),S=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup_type_avatar"),q=document.querySelector(".popup_type_new-card"),E=document.querySelector(".profile__title"),k=document.querySelector(".profile__image"),L=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__description"),x=q.querySelector(".popup__form"),A=x.querySelector(".popup__input_type_card-name"),T=x.querySelector(".popup__input_type_url"),U=document.querySelectorAll(".popup__close"),B=document.querySelector(".places__list"),w=document.querySelector(".popup_type_delete-card"),D=document.forms["new-place"],I=document.forms["edit-avatar"],P=document.forms["edit-profile"],N=document.forms["delete-card"],O=D.elements["place-name"],j=D.elements.link,J=I.elements.link,M=P.elements.name,H=P.elements.description,V=S.querySelector(".popup__form"),z=V.querySelector(".popup__input_type_name"),F=V.querySelector(".popup__input_type_description");function G(e,t,n){K=t,Q=n,s(e)}var K,Q,R={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function W(e,t){e.target.querySelector(".button").innerText=t}function X(e){e.target.querySelector(".button").innerText="Сохранение..."}function Y(e,t){v.src=e,v.alt=t,h.textContent=t,s(y)}!function(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?a(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),i(n,o,t)}))}))}(t,e)}))}(R),Promise.all([n("".concat(e.baseUrl,"/users/me"),{headers:e.headers}),n("".concat(e.baseUrl,"/cards"),{headers:e.headers})]).then((function(e){var t=e[0],n=e[1];k.style.backgroundImage="url('".concat(t.avatar,"')"),E.textContent=t.name,C.textContent=t.about,_=t._id,n&&Array.isArray(n)?n.forEach((function(e){e.userId=_;var t=o(e,w,Y,c,G);B.append(t)})):console.log("Данные о карточках не были получены или пусты.")})).catch((function(e){console.log("Произошла ошибка при загрузке данных о карточках:",e)})),g.addEventListener("click",(function(){l(V,R),s(S),z.value=E.textContent,F.value=C.textContent})),L.addEventListener("click",(function(){l(x,R),s(q)})),k.addEventListener("click",(function(){l(x,R),s(b)})),U.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){d(t)}))})),m.forEach((function(e){return function(e){e.addEventListener("click",f)}(e)})),P.addEventListener("submit",(function(t){t.preventDefault(),X(t);var o=M.value,r=H.value;(function(t,o){return n("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t,about:o})})})(z.value,F.value).then((function(){E.textContent=o,C.textContent=r,d(S)})).catch((function(e){return console.log("Не удалось изменить профиль. ".concat(e))})).finally((function(){setTimeout((function(){return W(t,"Сохранить")}),600,t)}))})),D.addEventListener("submit",(function(t){t.preventDefault(),X(t);var r,u,a={};a.name=O.value,a.link=j.value,(r=A.value,u=T.value,n("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:u})})).then((function(e){e.userId=_;var t=o(e,w,Y,c,G);B.prepend(t),d(q)})).catch((function(e){return console.log("Не удалось добавить карточку. ".concat(e))})).finally((function(){setTimeout((function(){return W(t,"Сохранить")}),600,t)}))})),I.addEventListener("submit",(function(t){var o;t.preventDefault(),X(t),(o=J.value,n("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})})).then((function(e){k.style.backgroundImage="url('".concat(e.avatar,"')"),d(b)})).finally((function(){setTimeout((function(){return W(t,"Сохранить")}),600,t)})).catch((function(e){console.log(e)})),I.reset()})),N.addEventListener("submit",(function(t){return function(t,o,r){var c;X(t),(c=o,n("".concat(e.baseUrl,"/cards/").concat(c),{method:"DELETE",headers:e.headers})).then((function(){r.remove(),d(w)})).finally((function(){setTimeout((function(){return W(t,"Да")}),600,t)})).catch((function(e){console.log(e)}))}(t,K,Q)}))})();